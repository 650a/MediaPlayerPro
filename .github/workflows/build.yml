name: build

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Java 21
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "21"
          cache: maven

      - name: Download BKCommonLib jar
        run: |
          mkdir -p libs
          curl -L -o libs/BKCommonLib.jar "https://cdn.modrinth.com/data/rTg6ckWb/versions/AZ67CsiD/BKCommonLib-1.21.1-v1-1795.jar"

      # IMPORTANT: install with our own tiny pom so Maven DOES NOT try to fetch BKCommonLib's real dependency tree
      - name: Install BKCommonLib into local Maven repo (no transitive deps)
        run: |
          cat > /tmp/bkcommonlib.pom <<'POM'
          <project xmlns="http://maven.apache.org/POM/4.0.0">
            <modelVersion>4.0.0</modelVersion>
            <groupId>com.bergerkiller.bukkit</groupId>
            <artifactId>BKCommonLib</artifactId>
            <version>1.21.1-v1</version>
            <packaging>jar</packaging>
            <name>BKCommonLib</name>
          </project>
          POM

          mvn -B -q install:install-file \
            -Dfile="libs/BKCommonLib.jar" \
            -DpomFile="/tmp/bkcommonlib.pom"

      - name: Build
        run: mvn -B -DskipTests clean package

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: MediaPlayer-jar
          path: target/*.jar
